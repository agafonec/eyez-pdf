import{_ as C}from"./AuthenticatedLayout-94876583.js";import{o as a,c as n,b as e,t as d,f as _,l as B,Z as j,r as l,a as i,w as h,F as f,n as O,g as P,m as V,s as N,d as J}from"./app-4d3e9db5.js";import{_ as A}from"./PrimaryButton-17bf03a5.js";import{_ as y}from"./_plugin-vue_export-helper-c27b6911.js";import{D as H,I as Y}from"./index-f468feba.js";import{B as F}from"./base-select-28adda10.js";import{h as L}from"./moment-fbc5633a.js";import"./pdf-logo-d2980b89.js";const M={name:"ProgressBar",props:{completed:{type:Number,default:0},success:{type:Number,default:0},failed:{type:Number,default:0},label:String}},$={key:0,class:"flex justify-between mb-1"},z={class:"text-base font-medium text-black"},E={class:"w-full bg-gray-200 rounded-full h-4"},T={class:"text-sm font-medium text-white"},U={class:""},Z={key:0},q={class:"text-green-400"},G=e("span",null,"Success: ",-1),K={class:"font-semibold"},Q={class:"text-red-400"},R=e("span",null,"Failed: ",-1),W={class:"font-semibold"};function X(t,r,o,u,s,c){return a(),n("div",null,[o.label?(a(),n("div",$,[e("span",z,d(o.label),1)])):_("",!0),e("div",E,[e("div",{class:"bg-green-400 h-4 flex items-center justify-center rounded-full transition-all",style:B(`width: ${o.completed}%`)},[e("span",T,d(o.completed)+"%",1)],4)]),e("div",U,[o.completed>=100?(a(),n("p",Z,"Processed: ")):_("",!0),e("ul",null,[e("li",q,[G,e("span",K,d(o.success),1)]),e("li",Q,[R,e("span",W,d(o.failed),1)])])])])}const ee=y(M,[["render",X]]),te={name:"SyncOpretail",components:{AuthenticatedLayout:C,Head:j,PrimaryButton:A,ProgressBar:ee,BaseSelect:F,DatePicker:H,IconCalendar:Y},props:{stores:{type:[Object,Array]},errors:[Object,Boolean],messages:[Array,String]},data(){var t,r;return{storesOptions:((t=this.stores)==null?void 0:t.length)>0||typeof this.stores=="object"?this.mapOptions():[],selectedStore:((r=this.stores)==null?void 0:r.length)>0||typeof this.stores=="object"?this.mapOptions()[0]:[],selectedDate:new Date,syncing:!1,fetchInterval:null,batchId:null,progress:null}},methods:{formattedDate(){return L(this.selectedDate).format("YYYY-MM-DD")},startSync(){this.syncing=!0,axios.post(route("profile.sync.start",{store:this.selectedStore.value}),{startDate:this.selectedDate}).then(t=>{this.batchId=t.data.batchId,this.fetchInterval=setInterval(this.fetchProgress,300)}).catch(t=>{console.log(t)})},mapOptions(){return typeof this.stores=="object"?Object.values(this.stores).map(t=>({value:t.id,label:t.name})):this.stores.map(t=>({value:t.id,label:t.name}))},fetchProgress(){axios.get(route("jobs.progress",{batchId:this.batchId})).then(t=>{var r,o,u,s,c,p;console.log("progress",this.progress),this.progress={percent:(r=t.data.progress)==null?void 0:r.processedJobs,success:(o=t.data.progress)==null?void 0:o.processedJobs,error:(u=t.data.progress)==null?void 0:u.failedJobs,total:(s=t.data.progress)==null?void 0:s.totalJobs,totalCompleted:((c=t.data.progress)==null?void 0:c.processedJobs)+((p=t.data.progress)==null?void 0:p.failedJobs)},this.progress.percent=Math.round(this.progress.totalCompleted/this.progress.total*100),this.progress.totalCompleted===this.progress.total&&clearInterval(this.fetchInterval)}).catch(t=>{console.error("Error fetching progress:",t)})}}},se=e("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Sync with opretail",-1),oe={class:"py-12"},re={class:"max-w-7xl mx-auto md:px-6 lg:px-8 space-y-6"},ae={class:"p-4 md:p-8 bg-white shadow md:rounded-lg"},le=e("header",null,[e("h2",{class:"text-lg font-medium text-gray-900"},"Start sync process with cameras.")],-1),ne={key:0,class:"max-w-md"},ce={class:"mb-4"},ie={class:""},de=e("label",{class:"block text-sm font-medium leading-6 text-gray-900"},"Select starting date you want to sync from",-1),me={class:"flex justify-center overflow-hidden w-full"},ue=["onClick"],pe=["value"];function he(t,r,o,u,s,c){const p=l("Head"),b=l("progress-bar"),x=l("base-select"),v=l("icon-calendar"),w=l("date-picker"),S=l("PrimaryButton"),k=l("AuthenticatedLayout");return a(),n(f,null,[i(p,{title:"Sync with opretail"}),i(k,null,{header:h(()=>[se]),default:h(()=>{var g;return[e("div",oe,[e("div",re,[e("div",ae,[le,((g=o.messages)==null?void 0:g.length)>0?(a(),n("p",{key:0,class:O(`${o.errors===!0?"text-red-500":"text-green-500"}`)},d(o.messages),3)):_("",!0),s.progress&&s.batchId?(a(),P(b,{key:1,completed:s.progress.percent,success:s.progress.success,failes:s.progress.error,label:"Syncing store"},null,8,["completed","success","failes"])):(a(),n(f,{key:2},[s.storesOptions.length>0?(a(),n("div",ne,[e("div",ce,[i(x,{options:s.storesOptions,id:"store",label:"נא לבחור חנות",currentValue:s.selectedStore,onChanged:r[0]||(r[0]=m=>s.selectedStore=m)},null,8,["options","currentValue"])]),e("div",ie,[de,i(w,{style:{direction:"ltr"},mode:"date","max-date":new Date,modelValue:s.selectedDate,"onUpdate:modelValue":r[1]||(r[1]=m=>s.selectedDate=m),popover:{visibility:"hover-focus",placement:"bottom",isInteractive:!0}},{default:h(({togglePopover:m,inputValue:D,inputEvents:I})=>[e("div",me,[e("button",{class:"flex items-center justify-center text-gray-900 ring-1 ring-inset ring-gray-300 rounded-md w-full py-1.5",onClick:()=>m()},[e("span",null,d(c.formattedDate()),1),i(v,{class:"mr-4"})],8,ue),e("input",V({value:D},N(I,!0),{class:"flex-grow p-0 bg-white dark:bg-gray-700 opacity-0 w-0"}),null,16,pe)])]),_:1},8,["max-date","modelValue"])]),i(S,{class:"mt-4",onClick:c.startSync},{default:h(()=>[J("Start Sync")]),_:1},8,["onClick"])])):_("",!0)],64))])])])]}),_:1})],64)}const Se=y(te,[["render",he]]);export{Se as default};
