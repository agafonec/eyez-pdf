import{_ as B}from"./AuthenticatedLayout-4ca57c00.js";import{o as a,c as n,b as e,t as i,f as p,l as C,Z as P,r as c,a as l,w as m,F as j,n as O,g as V,m as N,p as J,d as A}from"./app-dba17ce9.js";import{_ as Y}from"./PrimaryButton-d5624b73.js";import{_ as g}from"./_plugin-vue_export-helper-c27b6911.js";import{I as H}from"./icon-calendar-4daa4df6.js";import{B as L,P as F}from"./base-select-a833a5eb.js";import{D as M}from"./index-52465800.js";import{h as z}from"./moment-fbc5633a.js";import"./pdf-logo-d6dd1900.js";const E={name:"ProgressBar",props:{completed:{type:Number,default:0},success:{type:Number,default:0},failed:{type:Number,default:0},label:String}},$={key:0,class:"flex justify-between mb-1"},T={class:"text-base font-medium text-black"},U={class:"w-full bg-gray-200 rounded-full h-4"},Z={class:"text-sm font-medium text-white"},q={class:""},G={key:0},K={class:"text-green-400"},Q=e("span",null,"Success: ",-1),R={class:"font-semibold"},W={class:"text-red-400"},X=e("span",null,"Failed: ",-1),ee={class:"font-semibold"};function te(t,r,o,h,s,u){return a(),n("div",null,[o.label?(a(),n("div",$,[e("span",T,i(o.label),1)])):p("",!0),e("div",U,[e("div",{class:"bg-green-400 h-4 flex items-center justify-center rounded-full transition-all",style:C(`width: ${o.completed}%`)},[e("span",Z,i(o.completed)+"%",1)],4)]),e("div",q,[o.completed>=100?(a(),n("p",G,"Processed: ")):p("",!0),e("ul",null,[e("li",K,[Q,e("span",R,i(o.success),1)]),e("li",W,[X,e("span",ee,i(o.failed),1)])])])])}const se=g(E,[["render",te]]),oe={name:"SyncOpretail",components:{AuthenticatedLayout:B,Head:P,PrimaryButton:Y,ProgressBar:se,BaseSelect:L,DatePicker:M,IconCalendar:H,PageLoader:F},props:{stores:{type:[Object,Array]},syncBatchId:{type:String},user:{type:Number},errors:[Object,Boolean],messages:[Array,String]},data(){var t,r;return{storesOptions:((t=this.stores)==null?void 0:t.length)>0||typeof this.stores=="object"?this.mapOptions():[],selectedStore:((r=this.stores)==null?void 0:r.length)>0||typeof this.stores=="object"?this.mapOptions()[0]:[],selectedDate:new Date,syncing:!1,fetchInterval:null,batchId:this.syncBatchId??null,progress:null}},mounted(){console.log("batch id",this.batchId),this.batchId!==null&&(this.fetchInterval=setInterval(this.fetchProgress,300))},methods:{formattedDate(){return z(this.selectedDate).format("YYYY-MM-DD")},startSync(){this.syncing=!0,axios.post(route("profile.sync.start",{store:this.selectedStore.value}),{startDate:this.selectedDate}).then(t=>{this.syncing=!1,this.batchId=t.data.batchId,this.fetchInterval=setInterval(this.fetchProgress,300)}).catch(t=>{console.log(t)})},mapOptions(){return typeof this.stores=="object"?Object.values(this.stores).map(t=>({value:t.id,label:t.name})):this.stores.map(t=>({value:t.id,label:t.name}))},fetchProgress(){axios.get(route("jobs.progress",{batchId:this.batchId,user:this.user})).then(t=>{var r,o,h,s;this.progress={percent:(r=t.data.progress)==null?void 0:r.processedJobs,success:(o=t.data.progress)==null?void 0:o.processedJobs,error:t.data.progress.failedJobs,total:(h=t.data.progress)==null?void 0:h.totalJobs,totalCompleted:((s=t.data.progress)==null?void 0:s.processedJobs)+t.data.progress.failedJobs},this.progress.percent=Math.round(this.progress.totalCompleted/this.progress.total*100),this.progress.totalCompleted===this.progress.total&&clearInterval(this.fetchInterval)}).catch(t=>{console.error("Error fetching progress:",t)})}}},re=e("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Sync with opretail",-1),ae={class:"py-12"},ne={class:"max-w-7xl mx-auto md:px-6 lg:px-8 space-y-6"},ce={class:"p-4 md:p-8 bg-white shadow md:rounded-lg"},le=e("header",null,[e("h2",{class:"text-lg font-medium text-gray-900"},"Start sync process with cameras.")],-1),ie={key:1,class:"flex items-center mt-2"},de=e("span",null,"Preparing syncing, be patient...",-1),he={key:2},me={key:1,class:"max-w-md"},ue={key:0},pe={class:"mb-4"},_e={class:""},ge=e("label",{class:"block text-sm font-medium leading-6 text-gray-900"},"Select starting date you want to sync from",-1),fe={class:"flex justify-center overflow-hidden w-full"},ye=["onClick"],be=["value"],xe={key:1};function ve(t,r,o,h,s,u){const f=c("Head"),y=c("page-loader"),b=c("progress-bar"),x=c("base-select"),v=c("icon-calendar"),k=c("date-picker"),w=c("PrimaryButton"),S=c("AuthenticatedLayout");return a(),n(j,null,[l(f,{title:"Sync with opretail"}),l(S,null,{header:m(()=>[re]),default:m(()=>{var _;return[e("div",ae,[e("div",ne,[e("div",ce,[le,((_=o.messages)==null?void 0:_.length)>0?(a(),n("p",{key:0,class:O(`${o.errors===!0?"text-red-500":"text-green-500"}`)},i(o.messages),3)):p("",!0),s.syncing?(a(),n("div",ie,[de,l(y,{width:"30",height:"30"})])):(a(),n("div",he,[s.progress&&s.batchId?(a(),V(b,{key:0,completed:s.progress.percent,success:s.progress.success,failed:s.progress.error,label:"Syncing store"},null,8,["completed","success","failed"])):(a(),n("div",me,[s.storesOptions.length>0?(a(),n("div",ue,[e("div",pe,[l(x,{options:s.storesOptions,id:"store",label:"נא לבחור חנות",currentValue:s.selectedStore,onChanged:r[0]||(r[0]=d=>s.selectedStore=d)},null,8,["options","currentValue"])]),e("div",_e,[ge,l(k,{style:{direction:"ltr"},mode:"date","max-date":new Date,modelValue:s.selectedDate,"onUpdate:modelValue":r[1]||(r[1]=d=>s.selectedDate=d),popover:{visibility:"hover-focus",placement:"bottom",isInteractive:!0}},{default:m(({togglePopover:d,inputValue:I,inputEvents:D})=>[e("div",fe,[e("button",{class:"flex items-center justify-center text-gray-900 ring-1 ring-inset ring-gray-300 rounded-md w-full py-1.5",onClick:()=>d()},[e("span",null,i(u.formattedDate()),1),l(v,{class:"mr-4"})],8,ye),e("input",N({value:I},J(D,!0),{class:"flex-grow p-0 bg-white dark:bg-gray-700 opacity-0 w-0"}),null,16,be)])]),_:1},8,["max-date","modelValue"])]),l(w,{class:"mt-4",onClick:u.startSync},{default:m(()=>[A("Start Sync")]),_:1},8,["onClick"])])):(a(),n("div",xe," You have no stores created. Contact main user or support. "))]))]))])])])]}),_:1})],64)}const Oe=g(oe,[["render",ve]]);export{Oe as default};
